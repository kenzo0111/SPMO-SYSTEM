<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPMO Login</title>
  <link rel="stylesheet" href="AccessSystem.css" />
</head>

<body>
  <header class="header logo-text">
    <img src="cnscrefine.png" alt="Logo" />
    <div class="title">
      <h1>Supply and Property Management</h1>
      <hr />
      <span>WEB - BASED INVENTORY AND PROCUREMENT MANAGEMENT SYSTEM</span>
    </div>
  </header>

  <main class="wrap">
    <form class="card" onsubmit="handleLogin(event)">
      <h2>Sign in</h2>
      <div class="sub">Sign in with open account</div>

      <div class="field">
        <label class="label" for="email">Enter your E-mail</label>
        <input class="input" id="email" name="email" type="email" placeholder="cnsc.spmo@edu.ph" required />
      </div>

      <div class="field">
        <label class="label">Enter your Credentials</label>
        <div class="otp" id="otp">
          <input type="password" inputmode="numeric" maxlength="1" aria-label="Digit 1">
          <input type="password" inputmode="numeric" maxlength="1" aria-label="Digit 2">
          <input type="password" inputmode="numeric" maxlength="1" aria-label="Digit 3">
          <input type="password" inputmode="numeric" maxlength="1" aria-label="Digit 4">
          <input type="password" inputmode="numeric" maxlength="1" aria-label="Digit 5">
          <input type="password" inputmode="numeric" maxlength="1" aria-label="Digit 6">
        </div>
      </div>

      <div class="extras"><a href="#">Forgot password ?</a></div>

      <input type="hidden" name="credentials" id="hiddenPin" />

      <button class="btn" type="submit">Sign in</button>
    </form>
  </main>

  <script>
    // OTP / PIN behavior (No changes needed here for the fix)
    const otpInputs = Array.from(document.querySelectorAll('#otp input'));
    const hiddenPin = document.getElementById('hiddenPin');
    const emailInput = document.getElementById('email');

    const setHidden = () => hiddenPin.value = otpInputs.map(i => i.value).join('');

    otpInputs.forEach((input, idx) => {
      input.addEventListener('input', () => {
        input.value = input.value.replace(/[^0-9]/g, '').slice(0, 1);
        if (input.value && idx < otpInputs.length - 1) otpInputs[idx + 1].focus();
        setHidden();
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && !input.value && idx > 0) otpInputs[idx - 1].focus();
        if (e.key === 'ArrowLeft' && idx > 0) otpInputs[idx - 1].focus();
        if (e.key === 'ArrowRight' && idx < otpInputs.length - 1) otpInputs[idx + 1].focus();
      });

      input.addEventListener('paste', (e) => {
        e.preventDefault();
        const digits = (e.clipboardData.getData('text') || '').replace(/\D/g, '').slice(0, otpInputs.length).split('');
        otpInputs.forEach((box, i) => box.value = digits[i] || '');
        const next = digits.length >= otpInputs.length ? otpInputs[otpInputs.length - 1] : otpInputs[digits.length] || otpInputs[0];
        next.focus(); setHidden();
      });
    });

    function handleLogin(event) {
      // Prevent the form from doing a traditional page reload submission
      event.preventDefault();

      const userEmail = emailInput.value;
      const userPin = hiddenPin.value;

      // Basic validation: Check if all 6 PIN digits are entered
      if (userPin.length !== 6) {
        alert("Please enter all 6 digits of your credentials.");
        otpInputs[0].focus(); // Focus on the first PIN box
        return; // Stop the login process
      }

      // --- In a real application, you would send userEmail and userPin to a server here ---
      console.log(`Attempting login for Email: ${userEmail}, PIN: ${userPin}`);
      // alert(`Login successful!\nEmail: ${userEmail}\nPIN: ${userPin}`); 
      // ------------------------------------------------------------------------------------

      // Redirect to the dashboard upon successful "login"
      window.location.href = '../Dashboard/index.html';
    }
  </script>
</body>

</html>